<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sprinkler Modification Work Permit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#003f2d;
  --border:#cfd8d5;
}
body{
  margin:0;
  font-family:"Segoe UI", Arial, sans-serif;
  background:#f4f7f6;
  padding:24px;
}
.container{
  max-width:1000px;
  margin:auto;
  background:#fff;
  border-radius:8px;
  box-shadow:0 8px 24px rgba(0,0,0,.08);
  overflow:hidden;
}
.header{
  background:var(--primary);
  color:#fff;
  padding:26px 32px;
}
.header h1{margin:0;font-size:26px}
.content{padding:30px 32px}
.section{margin-bottom:30px}
.section-title{
  font-size:18px;
  font-weight:600;
  color:var(--primary);
  border-bottom:2px solid #e6f2ef;
  padding-bottom:6px;
  margin-bottom:16px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:18px;
}
label{font-size:13px;font-weight:600}
input,select{
  width:100%;
  height:42px;
  padding:8px 12px;
  border:1px solid var(--border);
  border-radius:5px;
}
input[readonly]{background:#f8fafc;font-weight:600}
.checkbox{
  display:flex;
  gap:30px;
  flex-wrap:wrap;
}
.checkbox label{display:flex;gap:6px}
canvas{
  width:100%;
  height:180px;
  border:1px solid var(--border);
  border-radius:5px;
}
button{
  padding:14px;
  border:none;
  background:var(--primary);
  color:#fff;
  width:100%;
  font-size:16px;
  font-weight:600;
  border-radius:5px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">
  <div class="header">
    <h1>Sprinkler Modification Work Permit</h1>
  </div>

  <div class="content">

    <div class="section">
      <div class="section-title">Work Permit Details</div>
      <div class="grid">
        <div>
          <label>Serial No</label>
          <input id="serial" value="AUTO" readonly>
        </div>
        <div>
          <label>Date</label>
          <input id="date" readonly>
        </div>
        <div>
          <label>Tower</label>
          <select id="tower">
            <option>A</option><option>B</option><option>C</option>
          </select>
        </div>
      </div>

      <div class="grid" style="margin-top:16px">
        <div>
          <label>Flat No</label>
          <input id="flat">
        </div>
        <div>
          <label>Owner Name</label>
          <input id="owner">
        </div>
        <div>
          <label>Contact</label>
          <input id="contact">
        </div>
      </div>

      <div style="margin-top:16px">
        <label>Email</label>
        <input id="email">
      </div>
    </div>

    <div class="section">
      <div class="section-title">Sprinkler Extension Required At</div>
      <div class="checkbox">
        <label><input type="checkbox" value="Hall">Hall</label>
        <label><input type="checkbox" value="Kitchen">Kitchen</label>
        <label><input type="checkbox" value="Dining">Dining</label>
        <label><input type="checkbox" value="MBR">MBR</label>
        <label><input type="checkbox" value="CBR">CBR</label>
        <label><input type="checkbox" value="GBR">GBR</label>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Owner Signature</div>
      <canvas id="sign" width="900" height="180"></canvas>
    </div>

    <button onclick="submitForm()">Submit Work Permit</button>

  </div>
</div>

<script>
document.getElementById("date").value =
  new Date().toLocaleDateString("en-GB");

const canvas=document.getElementById("sign");
const ctx=canvas.getContext("2d");
let drawing=false;

canvas.onmousedown=e=>{drawing=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY)};
canvas.onmousemove=e=>{if(drawing){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke()}};
canvas.onmouseup=()=>drawing=false;

function submitForm(){
  const ext=[];
  document.querySelectorAll(".checkbox input:checked")
    .forEach(c=>ext.push(c.value));

  fetch("https://script.google.com/macros/s/AKfycbxzPMmY0Kx-jQiNSjp0BCtyojTIaOFfzXkZbDRhSJcfiJZO90Ktat4ftYrkes51viKmNw/exec",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      tower:tower.value,
      flat:flat.value,
      owner:owner.value,
      contact:contact.value,
      email:email.value,
      extensions:ext,
      signature:canvas.toDataURL()
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="SUCCESS"){
      serial.value=res.serial;
      date.value=res.date;
      alert("Submitted successfully\nSerial No: "+res.serial);
    }else{
      alert(res.message);
    }
  })
  .catch(()=>alert("Submission failed"));
}
</script>

</body>
</html>
